# 专利检索与年费监控系统 - 虚拟环境运行指南

## 系统要求

- Python 3.8 或更高版本
- Windows 10/11 (推荐) 或 Linux/macOS
- 至少 2GB 可用内存
- 稳定的网络连接

## 虚拟环境设置与运行

### 1. 创建虚拟环境

如果还没有创建虚拟环境，请按以下步骤操作：

```powershell
# 在项目根目录下创建虚拟环境
python -m venv .venv
```

### 2. 激活虚拟环境

#### Windows (PowerShell)
```powershell
# 激活虚拟环境
.\.venv\Scripts\Activate.ps1

# 如果遇到执行策略问题，先运行：
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

#### Windows (命令提示符)
```cmd
# 激活虚拟环境
.venv\Scripts\activate.bat
```

#### Linux/macOS
```bash
# 激活虚拟环境
source .venv/bin/activate
```

### 3. 安装依赖包

激活虚拟环境后，安装所需的依赖包：

```powershell
# 升级pip到最新版本
python -m pip install --upgrade pip

# 安装项目依赖
pip install -r requirements.txt

# 安装Playwright浏览器（年费查询功能需要）
python -m playwright install
```

### 4. 验证安装

运行以下命令验证安装是否成功：

```powershell
# 测试核心功能
python test_fee_monitor.py

# 测试导入
python debug_import.py
```

### 5. 启动应用程序

#### 方式一：启动主应用程序
```powershell
# 启动完整的专利检索与年费监控系统
streamlit run app.py
```

#### 方式二：启动年费监控测试界面
```powershell
# 启动独立的年费监控测试界面
streamlit run test_monitor_ui.py
```

#### 方式三：指定端口启动
```powershell
# 如果默认端口被占用，可以指定其他端口
streamlit run app.py --server.port 8503
```

### 6. 访问应用程序

启动成功后，在浏览器中访问显示的URL：
- 本地访问：`http://localhost:8501`
- 网络访问：`http://你的IP地址:8501`

## 常用命令速查

### 虚拟环境管理
```powershell
# 激活虚拟环境
.\.venv\Scripts\Activate.ps1

# 退出虚拟环境
deactivate

# 查看已安装的包
pip list

# 更新requirements.txt
pip freeze > requirements.txt
```

### 应用程序运行
```powershell
# 启动主应用
streamlit run app.py

# 启动测试界面
streamlit run test_monitor_ui.py

# 后台运行（Linux/macOS）
nohup streamlit run app.py &

# 停止应用程序
# 在终端中按 Ctrl+C
```

## 功能模块说明

### 主要功能
1. **专利检索** - 搜索和筛选专利信息
2. **年费查询** - 查询专利年费缴纳情况
3. **年费监控** - 监控年费到期状态，包括：
   - 🔴 已失效 (法律状态为无权)
   - 🔴 已逾期 (超过缴费期限)
   - 🔴 紧急 (≤1天)
   - 🟠 急迫 (≤7天)
   - 🟡 注意 (≤30天)
   - 🟡 提醒 (≤90天)
   - 🟢 正常 (>90天)
4. **数据可视化** - 专利统计图表

### 数据存储
- 监控数据：`fee_monitor_data.json`
- 登录状态：`state.json`
- 缓存数据：`__pycache__/` 目录

## 故障排除

### 常见问题及解决方案

#### 1. 虚拟环境激活失败
```powershell
# 问题：无法激活虚拟环境
# 解决：设置执行策略
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

#### 2. 依赖包安装失败
```powershell
# 问题：pip安装失败
# 解决：升级pip并使用国内镜像
python -m pip install --upgrade pip
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
```

#### 3. Playwright浏览器安装失败
```powershell
# 问题：playwright install失败
# 解决：手动安装浏览器
python -m playwright install chromium
```

#### 4. 端口被占用
```powershell
# 问题：端口8501被占用
# 解决：使用其他端口
streamlit run app.py --server.port 8503
```

#### 5. 年费查询功能不可用
```powershell
# 问题：显示"Playwright-related function not available"
# 解决：
# 1. 确保已安装playwright: pip install playwright
# 2. 安装浏览器: python -m playwright install
# 3. 检查导入: python debug_import.py
```

## 开发环境配置

### 推荐的开发工具
- **IDE**: Visual Studio Code
- **Python扩展**: Python, Pylance
- **调试工具**: Python Debugger

### 代码格式化
```powershell
# 安装代码格式化工具
pip install black flake8

# 格式化代码
black *.py

# 检查代码质量
flake8 *.py
```

## 部署说明

### 本地部署
按照上述步骤在本地运行即可。

### 服务器部署
```bash
# 1. 克隆项目到服务器
git clone <项目地址>
cd 专利检索2

# 2. 创建虚拟环境
python3 -m venv .venv
source .venv/bin/activate

# 3. 安装依赖
pip install -r requirements.txt
python -m playwright install

# 4. 启动服务
nohup streamlit run app.py --server.port 8501 --server.address 0.0.0.0 &
```

## 更新日志

### v1.1.0 (2025-01-17)
- ✅ 新增年费监控功能
- ✅ 添加"已失效"状态监控（灰色标记）
- ✅ 支持法律状态检测
- ✅ 优化紧急程度排序
- ✅ 完善虚拟环境支持

### v1.0.0 (初始版本)
- ✅ 专利检索功能
- ✅ 年费查询功能
- ✅ 数据可视化功能

## 技术支持

如果遇到问题，请按以下顺序排查：

1. **检查虚拟环境**：确保已正确激活虚拟环境
2. **验证依赖**：运行 `pip list` 检查依赖包
3. **测试功能**：运行测试脚本验证功能
4. **查看日志**：检查终端输出的错误信息
5. **重新安装**：如有必要，删除虚拟环境重新创建

## 联系信息

- 项目文档：查看项目根目录下的 `.md` 文件
- 功能说明：`年费监控功能说明.md`
- 完成报告：`年费监控功能完成报告.md`