# 年费监控功能说明

## 功能概述

年费监控功能是专利检索系统的重要组成部分，帮助用户跟踪和管理专利年费的缴纳情况，避免因遗忘缴费而导致专利权失效。

## 主要功能

### 1. 年费查询与监控添加
- 在年费查询页面查询专利年费后，可以选择需要监控的年费项
- 支持单个或批量添加年费监控项
- 自动去重，避免重复添加相同的监控项

### 2. 年费监控管理
- 专门的"年费监控"标签页，集中管理所有监控项
- 实时显示监控统计信息（已逾期、紧急、急迫、注意等）
- 支持删除不需要的监控项

### 3. 紧急程度标记系统
根据当前日期与年费到期日期的临近程度，使用不同颜色标记紧急程度：

| 紧急程度 | 条件 | 颜色 | 说明 |
|---------|------|------|------|
| 已逾期 | 已过期 | 深红色 (#8B0000) | 需要立即处理 |
| 紧急 | ≤1天 | 红色 (#DC143C) | 极度紧急 |
| 急迫 | ≤7天 | 橙红色 (#FF4500) | 非常紧急 |
| 注意 | ≤30天 | 橙色 (#FF8C00) | 需要关注 |
| 提醒 | ≤90天 | 金色 (#FFD700) | 提前提醒 |
| 正常 | >90天 | 绿色 (#32CD32) | 状态正常 |

### 4. 数据持久化存储
- 监控数据保存在本地 `fee_monitor_data.json` 文件中
- 确保应用重启后监控数据不丢失
- 支持数据导出为Excel格式

## 使用流程

### 步骤1：专利检索
1. 在"检索与列表"标签页中搜索专利
2. 获取专利基本信息

### 步骤2：年费查询
1. 切换到"年费查询"标签页
2. 上传CNIPA登录状态文件（state.json）
3. 选择要查询年费的专利
4. 执行年费查询

### 步骤3：添加监控
1. 在年费查询结果下方，选择需要监控的年费项
2. 点击"添加选中项到监控"按钮
3. 系统自动保存监控数据

### 步骤4：监控管理
1. 切换到"年费监控"标签页
2. 查看所有监控项的状态和紧急程度
3. 根据需要删除或导出监控数据

## 界面特色

### 1. 直观的颜色编码
- 使用颜色直观显示年费的紧急程度
- 按紧急程度自动排序，优先显示需要关注的项目

### 2. 详细的统计信息
- 顶部显示各紧急程度的统计数量
- 帮助用户快速了解整体状况

### 3. 便捷的操作功能
- 支持单项删除监控项
- 一键导出所有监控数据
- 自动计算剩余天数

## 数据结构

监控数据包含以下字段：
- 专利名称
- 专利号
- 公司名称
- 费用种类
- 缴费期限届满日
- 金额
- 添加时间
- 紧急程度（动态计算）

## 技术实现

### 核心模块
- `fee_monitor.py`: 年费监控核心功能模块
- `FeeMonitor`: 监控数据管理类
- 集成到主应用 `app.py` 中

### 关键特性
- 自动紧急程度计算
- 数据持久化存储
- 重复项检测
- 排序和筛选功能

## 注意事项

1. **数据安全**: 监控数据存储在本地，请定期备份
2. **日期格式**: 系统要求日期格式为 YYYY-MM-DD
3. **登录状态**: 年费查询需要有效的CNIPA登录状态
4. **性能考虑**: 大量监控项可能影响界面响应速度

## 未来扩展

可能的功能扩展方向：
- 邮件/短信提醒功能
- 批量缴费状态更新
- 历史缴费记录管理
- 多用户数据隔离
- 云端数据同步

## 故障排除

### 常见问题
1. **监控数据丢失**: 检查 `fee_monitor_data.json` 文件是否存在
2. **紧急程度显示异常**: 确认日期格式正确
3. **添加监控失败**: 检查是否为重复项

### 日志文件
系统错误信息会在Streamlit界面中显示，便于问题诊断。